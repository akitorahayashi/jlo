# Jules Workflow Reproduction Guide

Steps to fully reproduce the Jules workflow in other projects.

## Prerequisites

1. **jlo CLI**: jlo is released and available for download from GitHub Releases
2. **Jules API Key**: Set as `secrets.JULES_API_KEY`
3. **Bot Token**: Set as `secrets.JLO_BOT_TOKEN` (for auto-merge)
4. **Repository Settings**:
   - `vars.JULES_PAUSED`: For pausing (set to `true` to pause)
   - `vars.JLO_VERSION`: Specify jlo version (defaults to `latest` if omitted)
   - Allow auto-merge: Enable
   - Branch protection on `jules`: Require status checks

## Required Files

### 1. .github/workflows/

| File | Purpose |
|------|---------|
| `jules-workflows.yml` | Main orchestration (scheduled execution) |
| `jules-run-planner.yml` | Manual Planner execution |
| `jules-run-implementer.yml` | Manual Implementer execution |
| `jules-automerge.yml` | Auto-merge Observer/Decider/Planner PRs |
| `jules-implementer-review.yml` | Auto-post review comments on Implementer PRs |

### 2. .github/actions/

| Directory | Purpose |
|-----------|---------|
| `install-jlo/` | Install jlo CLI |
| `configure-git/` | Configure git user |

**Note**: `setup/` is not needed (not used in Jules workflow)

### 3. .jules/ (scaffold)

Scaffold generated by `jlo init`. Required structure:

```
.jules/
├── JULES.md              # Agent contract
├── README.md             # Human documentation
├── .jlo-version          # Version marker
├── workstreams/
│   └── <name>/
│       ├── scheduled.toml   # REQUIRED: workstream有効化
│       ├── events/
│       │   ├── pending/
│       │   └── decided/
│       └── issues/
│           ├── index.md
│           └── <label>/
└── roles/
    ├── observers/
    │   ├── contracts.yml
    │   ├── event.yml
    │   └── <role>/
    │       ├── prompt.yml
    │       ├── role.yml
    │       ├── notes/
    │       └── feedbacks/
    ├── deciders/
    │   ├── contracts.yml
    │   ├── issue.yml
    │   ├── feedback.yml
    │   └── <role>/
    │       └── prompt.yml
    ├── planners/
    │   ├── contracts.yml
    │   └── prompt.yml
    └── implementers/
        ├── contracts.yml
        └── prompt.yml
```

## Setup Steps

### Step 1: Create `jules` Branch

```bash
git checkout -b jules
```

### Step 2: Copy Workflows

```bash
mkdir -p .github/workflows .github/actions

# From jlo repository (adjust path as needed)
cp <jlo>/.github/workflows/jules-workflows.yml .github/workflows/
cp <jlo>/.github/workflows/jules-run-planner.yml .github/workflows/
cp <jlo>/.github/workflows/jules-run-implementer.yml .github/workflows/
cp <jlo>/.github/workflows/jules-automerge.yml .github/workflows/
cp <jlo>/.github/workflows/jules-implementer-review.yml .github/workflows/
```

### Step 3: Copy Actions

```bash
cp -R <jlo>/.github/actions/install-jlo .github/actions/
cp -R <jlo>/.github/actions/configure-git .github/actions/
```

### Step 4: Modify `configure-git/action.yml`

Modify `configure-git/action.yml` to change git user settings for the target repository:

```yaml
git config user.name "<bot-name>"
git config user.email "<bot-email>"
```

### Step 5: Initialize Scaffold

```bash
jlo init
```

### Step 6: Configure Repository

1. **Secrets**:
   - `JULES_API_KEY`: Jules API key for agent execution
   - `JLO_BOT_TOKEN`: Personal Access Token (Classic) with scopes:
     - `repo` (Full control of private repositories)
     - `workflow` (Update GitHub Action workflows)
     - Required for: auto-merge, PR comments, push to jules branch

2. **Collaborator**:
   - Invite the bot account (owner of `JLO_BOT_TOKEN`) as a collaborator with write access

3. **Variables**:
   - `JULES_PAUSED` (optional)
   - `JLO_VERSION` (optional)

4. **Branch Protection** (`jules` branch):
   - Require status checks to pass
   - Allow auto-merge

5. **Auto-Review Configuration** (disable auto-review, enable on-demand via comments):

   Create `.coderabbit.yaml`:
   ```yaml
   reviews:
     auto_review:
       enabled: false
   ```

   Create `.gemini/config.yaml`:
   ```yaml
   code_review:
     disable: false
     pull_request_opened:
       summary: false
       code_review: false
   ```

   These settings disable automatic review on PR open, but allow manual trigger via:
   - `/gemini summary`
   - `/gemini review`
   - `@coderabbitai review`

   (Triggered by `jules-implementer-review.yml` on implementer PRs)

### Step 7: Commit and Push

```bash
git add .
git commit -m "Initialize Jules workflow"
git push -u origin jules
```

## Workflow Execution Flow

```
jules-workflows.yml (scheduled/manual)
    │
    ├── Observer → jules-observer-* branch → PR → auto-merge
    ├── Decider  → jules-decider-*  branch → PR → auto-merge
    ├── Planner  → jules-planner-*  branch → PR → auto-merge
    └── Implementer → jules-implementer-* branch → PR → human review
```

- Observer/Decider/Planner: Only `.jules/` changes, auto-merge
- Implementer: Source code changes, human review required

## Key Differences from menv

When copying to menv, the following are **not needed**:

- `.github/actions/setup/` (not used in Jules)
- Workflows other than Jules (e.g., `ci-*.yml`)

## Troubleshooting

### Auto-merge Fails

1. Check if "Allow auto-merge" is enabled in Repository Settings
2. Check if Branch Protection is set on the `jules` branch
3. Check if `JLO_BOT_TOKEN` has appropriate permissions

### Workflow Not Running

1. Check if `vars.JULES_PAUSED` is not set to `true`
2. Check if `.jules/workstreams/*/scheduled.toml` exists on the `jules` branch

### jlo Install Fails

1. Check if jlo releases are published in the target repository
2. Check if the URL in `install-jlo/action.yml` is correct
