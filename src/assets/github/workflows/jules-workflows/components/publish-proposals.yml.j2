  publish-proposals:
    needs: [wait-after-run-innovators]
    if: |
      needs.wait-after-run-innovators.result == 'success'
    runs-on: {{ runner }}
    timeout-minutes: 30
    env:
      GH_TOKEN: {{ gha_expr("secrets.JLO_BOT_TOKEN") }}
    steps:
      - uses: actions/checkout@v4
        with:
          ref: '{{ worker_branch }}'
          fetch-depth: 0
          token: {{ gha_expr("secrets.JLO_BOT_TOKEN") }}

      - name: Configure Git
        uses: ./.github/actions/configure-git

      - name: Install jlo
        uses: ./.github/actions/install-jlo

      - name: Publish proposals
        run: jlo workflow exchange publish-proposals

      - name: Validate repository
        run: jlo workflow doctor

      - name: Merge published proposal cleanup
        run: |
          set -euo pipefail
          if [ -z "$(git status --porcelain .jules)" ]; then
            echo "No proposal cleanup changes detected."
            exit 0
          fi
          jlo workflow gh push worker-branch \
            --change-token "publish-proposals" \
            --commit-message "jules: publish innovator proposals" \
            --pr-title "chore: publish innovator proposals" \
            --pr-body "Automated publication cleanup for innovator proposals."
