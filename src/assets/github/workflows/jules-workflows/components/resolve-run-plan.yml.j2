  resolve-run-plan:
    needs: [bootstrap]
    if: |
      needs.bootstrap.result == 'success' &&
      ((vars.JLO_PAUSED || 'false') != 'true' || github.event_name != 'schedule') &&
      (github.event_name == 'schedule' || github.event_name == 'workflow_dispatch')
    runs-on: {{ runner }}
    timeout-minutes: 10
    outputs:
      json: {{ gha_expr("steps.check.outputs.json") }}
    steps:
      - name: Check schedule
        id: check
        env:
          ENTRY_POINT: {{ gha_expr("github.event_name == 'workflow_dispatch' && (github.event.inputs.entry_point || 'narrator') || 'narrator'") }}
        run: |
          set -euo pipefail
          run_narrator=false
          run_innovators=false
          run_observers=false
          run_decider=false
          run_planner=false
          run_implementer=false

          case "${ENTRY_POINT}" in
            narrator)
              run_narrator=true
              run_observers=true
              run_decider=true
              run_planner=true
              run_implementer=true
              ;;
            innovators)
              run_innovators=true
              ;;
            observers)
              run_observers=true
              run_decider=true
              run_planner=true
              run_implementer=true
              ;;
            decider)
              run_decider=true
              run_planner=true
              run_implementer=true
              ;;
            requirements)
              run_planner=true
              run_implementer=true
              ;;
            *)
              echo "::error::Unsupported entry_point '${ENTRY_POINT}'. Allowed values: narrator, innovators, observers, decider, requirements."
              exit 1
              ;;
          esac

          echo "json={\"should_run\":true,\"entry_point\":\"${ENTRY_POINT}\",\"run_narrator\":${run_narrator},\"run_innovators\":${run_innovators},\"run_observers\":${run_observers},\"run_decider\":${run_decider},\"run_planner\":${run_planner},\"run_implementer\":${run_implementer}}" >> "$GITHUB_OUTPUT"
