  check-schedule:
    needs: wait-after-narrator
    if: |
      ((vars.JLO_PAUSED || 'false') != 'true' || github.event_name != 'schedule') &&
      (github.event_name == 'schedule' || github.event_name == 'workflow_dispatch' || github.event_name == 'workflow_call') &&
      (
        (
          (
            github.event_name == 'schedule' ||
            (github.event_name == 'workflow_dispatch' && (github.event.inputs.entry_point || 'narrator') == 'narrator') ||
            (github.event_name == 'workflow_call' && (inputs.entry_point || 'narrator') == 'narrator')
          ) &&
          needs.wait-after-narrator.result == 'success'
        ) ||
        (
          (
            (github.event_name == 'workflow_dispatch' && (github.event.inputs.entry_point || 'narrator') != 'narrator') ||
            (github.event_name == 'workflow_call' && (inputs.entry_point || 'narrator') != 'narrator')
          ) &&
          needs.wait-after-narrator.result == 'skipped'
        )
      )
    runs-on: {{ runner }}
    timeout-minutes: 10
    outputs:
      json: {{ gha_expr("steps.check.outputs.json") }}
    steps:
      - name: Check schedule
        id: check
        env:
          ENTRY_POINT: {{ gha_expr("github.event_name == 'workflow_dispatch' && (github.event.inputs.entry_point || 'narrator') || github.event_name == 'workflow_call' && (inputs.entry_point || 'narrator') || 'narrator'") }}
        run: |
          set -euo pipefail
          run_innovators_1=false
          run_observers=false
          run_innovators_2=false
          run_publish_proposals=false
          run_decider=false
          run_planner=false
          run_implementer=false

          case "${ENTRY_POINT}" in
            narrator)
              run_innovators_1=true
              run_observers=true
              run_innovators_2=true
              run_publish_proposals=true
              run_decider=true
              run_planner=true
              run_implementer=true
              ;;
            observers)
              run_innovators_1=true
              run_observers=true
              run_innovators_2=true
              run_publish_proposals=true
              ;;
            decider)
              run_decider=true
              ;;
            planner)
              run_planner=true
              ;;
            implementer)
              run_implementer=true
              ;;
            *)
              echo "::error::Unsupported entry_point '${ENTRY_POINT}'."
              exit 1
              ;;
          esac

          echo "json={\"should_run\":true,\"entry_point\":\"${ENTRY_POINT}\",\"run_innovators_1\":${run_innovators_1},\"run_observers\":${run_observers},\"run_innovators_2\":${run_innovators_2},\"run_publish_proposals\":${run_publish_proposals},\"run_decider\":${run_decider},\"run_planner\":${run_planner},\"run_implementer\":${run_implementer}}" >> "$GITHUB_OUTPUT"
