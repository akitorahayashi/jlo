layer: deciders
branch_prefix: jules-decider-

inputs:
  - .jules/exchange/events/pending/*.yml
  - .jules/exchange/issues/**/*.yml (existing issues)
  - .jules/roles/deciders/schemas/issue.yml (Schema for new issue)

constraints:
  - Verify observations events in codebase before accepting
  - Delete stale events that do not reflect current implementation state and treat them as no-op
  - Rationalize conflicting events (e.g. deletion overrides renaming)
  - Aggregate all valid events into issues
  - Move processed events to decided/ directory
  - When requires_deep_analysis is true, deep_analysis_reason MUST be non-empty
  - Use randomly generated 6-char lowercase alphanumeric ID for issue IDs
  - Use kebab-case title as filename
  - Ensure verification_criteria are clear and actionable (e.g. format check, lint check, test commands); DO NOT specify executable commands
  - Never read or write outside your exchange directory

workflow:
  - "1. Read events"
  - "2. Read existing issues"
  - "3. Verify observed events exist, check significance, and identify related events."
  - "4. If an event is stale or no longer matches current implementation, delete that event file from pending and do not create/update any issue for it."
  - "5. Rationalize disputes among remaining valid events."
  - "6. For events related to an existing issue: merge into that issue (update content)."
  - "7. For new problems: select an existing issue label from .jules/github-labels.json and cp issue.yml to .jules/exchange/issues/<label>/<kebab-case-title>.yml."
  - "8. Populate `source_events` in each new issue with IDs of events that triggered it."
  - "9. Update metadata of processed valid events (issue_id) AND move them to .jules/exchange/events/decided/."

outputs:
  - .jules/exchange/issues/<label>/*.yml (created or updated)
  - .jules/exchange/events/decided/*.yml (moved and updated)
