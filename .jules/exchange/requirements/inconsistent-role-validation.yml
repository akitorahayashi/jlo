schema_version: 2

# Metadata
id: "r0lev1"
source_events:
  - "9um5wl"
title: "Inconsistent Role Validation and Primitive Obsession"
label: "refacts"
priority: "medium"
summary: "Standardize role identifier validation across the codebase using RoleId."

# Content
goal: |
  Ensure all role identifiers are validated consistently using the RoleId type, removing primitive obsession and duplicated validation logic.

problem: |
  Role identifiers are validated inconsistently. While `RoleId` exists, some parts of the application (e.g., `execute_mock` in `src/app/commands/run/layer/innovators.rs`) use raw strings and a separate `validate_safe_path_component` function. This violates "Represent Valid States Only".

impact: |
  Increases the risk of invalid role identifiers being processed, leading to potential security issues (path traversal) or runtime errors. It also increases maintenance burden due to duplicated logic.

desired_outcome: |
  All role identifier handling uses `RoleId`. The `validate_safe_path_component` function is either deprecated, removed, or used exclusively within `RoleId`.

constraints: []
risks: []

# Specifics
affected_areas:
  - "src/domain/roles/role_id.rs"
  - "src/app/commands/run/layer/innovators.rs"
  - "src/domain/roles/validation.rs"

acceptance_criteria:
  - "`execute_mock` in `innovators.rs` accepts and uses `RoleId` instead of `&str`."
  - "Raw string validation logic for roles is replaced by `RoleId::new`."

verification_criteria:
  - "Grep for `validate_safe_path_component` usage to ensure it is not used for role validation outside of `RoleId`."
  - "Run existing tests for `RoleId`."

# Analysis Flags
requires_deep_analysis: false
deep_analysis_reason: ""
