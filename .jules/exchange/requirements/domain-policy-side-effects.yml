schema_version: 2

# Metadata
id: "purpol"
source_events:
  - "evt001"
title: "Remove Side Effects from Domain Policy"
label: "refacts"
priority: "high"
summary: "Refactor domain policy to avoid direct filesystem access."

# Content
goal: |
  Make the domain layer pure by removing direct filesystem side effects from policy logic.

problem: |
  `src/domain/layers/execute/policy.rs` imports `std::fs` and performs directory reads directly in `has_pending_events`. This violates architectural boundaries.

impact: |
  The domain logic is coupled to the filesystem, making it harder to test without mocking the FS at the OS level, and violating the "Clean Architecture" principle.

desired_outcome: |
  `has_pending_events` uses the `RepositoryFilesystem` trait or another injected dependency instead of `std::fs`.

constraints: []
risks: []

# Specifics
affected_areas:
  - "src/domain/layers/execute/policy.rs"

acceptance_criteria:
  - "`std::fs` import is removed from `src/domain/layers/execute/policy.rs`."
  - "Function signature is updated to accept a repository/store trait."

verification_criteria:
  - "Check imports in `src/domain/layers/execute/policy.rs`."

# Analysis Flags
requires_deep_analysis: false
deep_analysis_reason: ""
