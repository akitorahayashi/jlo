schema_version: 2

# Metadata
id: "gitadp"
source_events:
  - "gitalc"
  - "gitfbk"
title: "Refactor Git Adapter for Performance and Correctness"
label: "refacts"
priority: "high"
summary: "Fix inefficient allocations and hidden fallbacks in GitCommandAdapter."

# Content
goal: |
  Improve the performance and correctness of the `GitCommandAdapter`.

problem: |
  `GitCommandAdapter` eagerly allocates strings for command output even when unused, and `get_nth_ancestor` silently falls back to the root commit on error instead of propagating the failure.

impact: |
  Unnecessary allocations reduce performance. Hidden fallbacks in ancestry lookup can lead to logic errors in layers relying on accurate history (e.g., changes feed).

desired_outcome: |
  Output is allocated only when needed. Ancestry lookup returns an error or `Option::None` when the ancestor does not exist, rather than a default value.

constraints: []
risks: []

# Specifics
affected_areas:
  - "src/adapters/git/git_command.rs"

acceptance_criteria:
  - "Eager `to_string()` on stdout is removed/optimized."
  - "`get_nth_ancestor` propagates errors or returns explicit option for missing ancestors."

verification_criteria:
  - "Code review of `src/adapters/git/git_command.rs`."

# Analysis Flags
requires_deep_analysis: false
deep_analysis_reason: ""
