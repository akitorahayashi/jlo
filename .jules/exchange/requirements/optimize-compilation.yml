schema_version: 2

# Metadata
id: "optcmp"
source_events:
  - "evt002"
title: "Optimize Compilation Time"
label: "refacts"
priority: "medium"
summary: "Investigate and reduce compilation time to improve feedback loop."

# Content
goal: |
  Reduce the project compilation time to enable a faster inner development loop.

problem: |
  Compilation time is significantly high (> 1 minute), hindering TDD and rapid iteration.

impact: |
  Developer productivity is reduced due to long wait times.

desired_outcome: |
  Compilation time is noticeably reduced. Unused dependencies are removed. Heavy dependencies are optimized or replaced if possible.

constraints: []
risks:
  - "Replacing `reqwest` with `ureq` or `minreq` might introduce subtle behavior differences (e.g. timeout handling, redirect policy, proxy support)."
  - "Code changes required in `src/adapters/jules_client/http.rs`."

# Specifics
affected_areas:
  - "Cargo.toml"
  - "src/adapters/jules_client/http.rs"

acceptance_criteria:
  - "Dependency tree analyzed."
  - "Unused dependencies removed."

verification_criteria:
  - "Measure `cargo build` time before and after changes."

# Analysis Flags
requires_deep_analysis: false
deep_analysis_reason: |
  Need to profile build times and dependency graph to identify bottlenecks.

  **Analysis Findings:**
  - **Build Time:** Measured ~1m 25s for clean build.
  - **Dependency Analysis:**
      - `reqwest` (blocking) pulls heavy async runtime `tokio`, `hyper`, `rustls`. This is the single largest contributor to compile time.
      - `toml` and `toml_edit` are both present. `toml` is used for simple parsing/serialization, while `toml_edit` is used for modifying files while preserving comments. Deduplication is possible but `toml_edit` API is more verbose.
      - `minijinja` is lightweight and necessary.
      - `include_dir` is necessary for asset embedding.

  **Optimization Strategy:**
  - **Primary:** Replace `reqwest` with a synchronous HTTP client like `ureq` (v3). This eliminates `tokio`, `hyper`, and `rustls` dependencies, potentially cutting build time significantly.
  - **Secondary:** Investigate consolidating `toml` and `toml_edit` usage to just `toml_edit` to reduce dependency count.
