schema_version: 2
id: "tst890"
source_events:
  - "conf01"
  - "dome01"
  - "m0ck01"
  - "p2r5t8"
  - "x7k3m9"
title: "Improve Test Coverage and Quality"
label: "tests"
priority: "high"
summary: "Increase unit test coverage for core logic and decouple domain execution from integration tests."
goal: |
  Ensure that critical business logic, configuration loading, and mock execution are verified by fast, isolated unit tests.
problem: |
  Current testing relies heavily on slow integration tests (`tests/cli_commands.rs`). Key areas like `detect_repository_source`, `execute_mock`, and `execute_real` logic lack unit test coverage. Additionally, `tests/commands_core.rs` duplicates integration scenarios, adding maintenance overhead.
impact: |
  Lack of unit tests makes it hard to verify edge cases (e.g., git failures), increases the risk of regressions, and slows down the feedback loop. Redundant tests waste CI resources.
desired_outcome: |
  Core domain logic is covered by unit tests. Redundant integration tests are removed.
affected_areas:
  - "src/app/commands/run/config.rs"
  - "src/domain/layers/"
  - "tests/commands_core.rs"
  - "tests/cli_commands.rs"
acceptance_criteria:
  - "Add unit tests for `detect_repository_source` (and related config logic)."
  - "Add unit tests for `execute_mock` logic in `DeciderLayer` and `ImplementerLayer`."
  - "Add unit tests for `execute_real` logic where possible, using mocks for external ports."
  - "Remove `tests/commands_core.rs` if it is fully redundant with `tests/cli_commands.rs`."
verification_criteria:
  - "Run `cargo test` and ensure all new tests pass."
  - "Run `cargo tarpaulin` (if available) or check coverage report to verify increase."
  - "Verify `tests/commands_core.rs` is gone and `tests/cli_commands.rs` still passes."
requires_deep_analysis: false
deep_analysis_reason: ""
