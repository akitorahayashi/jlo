schema_version: 1

# Metadata
id: str001
issue_id: ""
created_at: "2025-05-18"
author_role: structural_arch
confidence: high

# Content
title: "Inconsistent Command Module Structure"
statement: |
  The command layer in `src/app/commands/` exhibits inconsistent module structure, mixing file-based modules (e.g., `init.rs`) with directory-based modules (e.g., `add/`). Additionally, the naming collision between `update.rs` (control-plane update) and `cli_upgrade.rs` (binary upgrade) creates semantic ambiguity and findability issues.

# Evidence supporting the observation
evidence:
  - path: "src/app/commands/mod.rs"
    loc:
      - "mod add;"
      - "mod init;"
      - "mod update;"
      - "mod cli_upgrade;"
    note: "Top-level module file exposes a mix of file-based and directory-based command implementations."
  - path: "src/app/commands/init.rs"
    loc:
      - "pub fn execute<W, R, G>("
    note: "Major command `init` is implemented as a single file, inconsistent with `add` which is a directory."
  - path: "src/app/commands/add/mod.rs"
    loc:
      - "pub mod role;"
    note: "Command `add` is implemented as a directory with submodules, inconsistent with `init`."
  - path: "src/app/commands/update.rs"
    loc:
      - "pub fn execute<W>("
    note: "Command `update` manages control-plane updates, but its name conflicts semantically with `cli_upgrade`."
  - path: "src/app/commands/cli_upgrade.rs"
    loc:
      - "pub fn execute() -> Result<CliUpgradeResult, AppError>"
    note: "Command `cli_upgrade` manages binary upgrades, creating potential confusion with `update`."
