schema_version: 2

# Metadata
fingerprint: "refactor_run_config"
id: "refactor_run_config"
category: "refacts"
priority: "medium"
status: "open"
requires_deep_analysis: false
deep_analysis_reason: ""
sources:
  - "2026-01-29_133500_refacts_data_arch_da01"

# Content
title: "Decouple RunConfig from Serialization and Primitives"
summary: "Refactor RunConfig to separate domain model from serialization and use strong types."

affected_areas:
  - "src/domain/run_config.rs"

constraints: []

risks: []

problem: |
  The `RunConfig` and `JulesApiConfig` domain models in `src/domain/run_config.rs` violate the Boundary Sovereignty principle by mixing domain definitions with `serde` attributes. They also suffer from Primitive Obsession, using `String` for URLs and other configuration values without validation types.

impact: |
  Violates Boundary Sovereignty, coupling domain logic to serialization framework (serde).
  Makes validation harder and spread out, rather than enforced by types.
  Leaks implementation details (DTO structure) into the domain.

desired_outcome: |
  Pure domain model for configuration (RunConfig, JulesApiConfig) without `serde` attributes.
  DTOs (Data Transfer Objects) for loading configuration from TOML/JSON, which then convert to Domain models.
  Strong types for fields like `api_url` (e.g., `Url` type) to ensure validity upon creation.

acceptance_criteria:
  - "RunConfig and related structs in domain have no serde attributes."
  - "api_url uses a validated URL type (e.g. from `url` crate)."
  - "Conversion from DTO to Domain is implemented and tested."
