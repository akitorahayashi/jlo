schema_version: 2

# Metadata
id: "940077"
source_events:
  - "qa1tst"
  - "k7m2x9"
  - "p4q5r6"
title: "Critical Test Coverage"
label: "tests"
priority: "high"
summary: "Add missing unit tests for critical logic in Narrator and Update commands, and enable testing of PromptAssembly."

# Content
problem: |
  Several critical areas of the codebase lack unit tests:
  1. Narrator parsing logic (`parse_numstat`, `extract_to_commit`) is untested.
  2. `jlo update` execute function is untested.
  3. `PromptAssembly` is coupled to the filesystem, preventing isolation for tests.

impact: |
  Lack of tests increases the risk of regressions in core functionality. Coupling prevents effective testing.

desired_outcome: |
  High confidence in core logic through comprehensive unit tests:
  - Narrator parsing logic is fully tested.
  - `jlo update` logic is tested.
  - `PromptAssembly` is decoupled from FS (using a trait or similar) and tested.

constraints: []
risks: []

# Specifics
affected_areas:
  - "src/app/commands/run/narrator.rs"
  - "src/app/commands/update.rs"
  - "src/services/prompt_assembly.rs"

acceptance_criteria:
  - "Unit tests exist for Narrator parsing functions."
  - "Unit tests exist for `jlo update` logic."
  - "`PromptAssembly` uses an abstraction for IO and has tests."

verification_commands:
  - "cargo test"

# Analysis Flags
requires_deep_analysis: false
deep_analysis_reason: ""
