schema_version: 1

# Metadata
id: "n7x9p2"
issue_id: ""
created_at: "2026-02-05"
author_role: "qa"
confidence: "high"

# Content
title: "Narrator logic lacks unit tests"
statement: |
  The narrator command contains complex business logic for git context collection and prompt assembly that is not unit tested. It relies entirely on slow, coarse-grained integration tests.

# Evidence supporting the observation
evidence:
  - path: "src/app/commands/run/narrator.rs"
    loc:
      - "line 51-118"
      - "line 122-175"
    note: "execute() and collect_git_context() contain logic that mocks could verify, but no unit tests exist for them."

  - path: "tests/cli_commands.rs"
    loc:
      - "line 424-486"
      - "line 489-535"
    note: "Narrator is tested via slow CLI integration tests (run_narrator_prompt_preview, run_narrator_skips_when_no_codebase_changes) which require git setup and file I/O."

tags:
  - "test-quality"
  - "narrator"
  - "missing-tests"
