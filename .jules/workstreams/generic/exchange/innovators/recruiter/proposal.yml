schema_version: 1

id: "prp051"
persona: "recruiter"
workstream: "generic"
created_at: "2026-02-08"

title: "Establish 'Warden' Observer for Security & Vulnerability Auditing"

problem: |
  The repository currently lacks a dedicated role for application security (AppSec) and supply chain security auditing.
  Critical security checks like `cargo audit` (CVE scanning) are absent from `.github/workflows/run-linters.yml`.
  While `rustacean` reviews Rust idioms and `devops` ensures pipeline reproducibility, neither role explicitly owns:
  1. `unsafe` code justification and minimization.
  2. Input validation and injection vector analysis.
  3. Dependency vulnerability management (CVEs).
  This creates a "blind spot" where security regressions can merge silently.

introduction: |
  Introduce a new observer role named **warden** (Security Auditor).
  This role will act as the repository's security conscience, owning the definition of secure coding practices and the enforcement of vulnerability checks.

  **Proposed Role Definition (.jules/roles/observers/roles/warden/role.yml):**

  ```yaml
  role: warden
  layer: observers

  profile:
    focus: Audit the codebase for security vulnerabilities, unsafe patterns, and supply chain risks.

    analysis_points:
      - Dependency vulnerabilities (CVEs and unmaintained crates)
      - `unsafe` block justification and soundness
      - Input validation and sanitization gaps
      - Secret exposure and credential management
      - API surface hardness (authZ/authN boundaries)

    first_principles:
      - "Safety Over Speed: blocked builds are better than shipped exploits."
      - "Unsafe Must Be Justified: every `unsafe` block requires a comment explaining why safe code is impossible."
      - "Trust No Input: assume all external data is malicious until validated."
      - "Know Your Supply Chain: dependencies are code we didn't write but still own."

    guiding_questions:
      - "Does this change introduce a new dependency, and has it been audited?"
      - "Is this `unsafe` block strictly necessary, and are its invariants documented?"
      - "Where does this data come from, and is it validated at the boundary?"
      - "Could a malicious actor trigger a panic or OOM via this input?"

    anti_patterns:
      - "Suppressing `cargo audit` warnings without remediation."
      - "Using `unsafe` for performance without benchmarks."
      - "Implicit trust of file/network inputs."
      - "Committing secrets or tokens to the repository."

    evidence_expectations:
      - "Cite the specific CVE or advisory for dependency issues."
      - "Cite the exact line of `unsafe` code and the missing safety comment."
      - "Cite the input path and the missing validation logic."
  ```

importance: |
  Security is a non-functional requirement that cannot be retrofitted easily.
  Without a dedicated role, security checks are ad-hoc and prone to being skipped under pressure.
  Establishing `warden` now ensures that the new architecture (domain models, scaffolding) is built on a secure foundation.

impact_surface:
  - "**New Role:** .jules/roles/observers/roles/warden/role.yml"
  - "**CI Workflow:** .github/workflows/run-linters.yml (addition of `cargo audit`)"
  - "**Review Process:** `warden` will participate in PR reviews, specifically targeting `unsafe` usage and dependency changes."

implementation_cost: |
  Low. The primary cost is:
  1. Creating the role definition file.
  2. Adding `cargo install cargo-audit` and `cargo audit` to the CI pipeline.
  3. Initial triage of existing warnings (if any).

consistency_risks:
  - "**False Positives:** `cargo audit` might flag unfixable vulnerabilities in transitive dependencies, requiring an ignore mechanism (`audit.toml`)."
  - "**Review Noise:** `warden` might generate initial noise on `unsafe` blocks that are legacy."

verification_signals:
  - "**CI Signal:** `cargo audit` running and passing in `run-linters.yml`."
  - "**Role Output:** `warden` posting comments on PRs referencing `unsafe` blocks or CVEs."
