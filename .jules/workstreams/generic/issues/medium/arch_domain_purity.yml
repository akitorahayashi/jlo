schema_version: 2
id: "arch_domain_purity"
fingerprint: "arch_domain_purity"
title: "Domain Model Impurity and Coupling"
priority: "medium"
summary: "Domain models are coupled to infrastructure libraries (serde), use primitive types, and contain redundant definitions."

problem: |
  The domain layer exhibits several architectural violations:
  1. `src/domain/run_config.rs` models are directly coupled to `serde`, violating Boundary Sovereignty.
  2. `src/domain/run_config.rs` uses `String` for URLs (`api_url`), exhibiting Primitive Obsession.
  3. `src/domain/setup.rs` defines `Component` and `ComponentMeta` with redundant fields, violating Normalized Independence (SSOT).
  4. Integration tests in `tests/commands_api.rs` invoke library API (`jlo::init`) instead of the binary, coupling tests to internal implementation details.

impact: |
  Reduces maintainability, hampers validation (Primitive Obsession), and creates tight coupling between domain logic and infrastructure concerns (serialization).

desired_outcome: |
  - Decouple domain models from `serde` (use DTOs or separate mapping).
  - Use typed Value Objects (e.g. `url::Url`) instead of Strings.
  - Consolidate `Component` and `ComponentMeta` or define a clear transformation.
  - Refactor integration tests to use the CLI binary interface.

constraints: []
risks: []

affected_areas:
  - "src/domain/run_config.rs"
  - "src/domain/setup.rs"
  - "tests/commands_api.rs"

acceptance_criteria:
  - "`RunConfig` no longer derives `Deserialize` directly (or does so via a feature flag/DTO)."
  - "`api_url` uses a URL type or validated wrapper."
  - "`Component` and `ComponentMeta` redundancy is resolved."
  - "Integration tests run `jlo` via `std::process::Command` or `assert_cmd`."

verification_commands:
  - "grep 'derive(Deserialize)' src/domain/run_config.rs"
  - "grep 'api_url: String' src/domain/run_config.rs"
  - "grep 'jlo::init' tests/commands_api.rs"

requires_deep_analysis: false
deep_analysis_reason: ""
