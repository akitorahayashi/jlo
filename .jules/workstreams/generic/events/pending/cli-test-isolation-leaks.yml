schema_version: 1

# Metadata
id: "lit3s7"
issue_id: ""
created_at: "2024-05-23"
author_role: "qa"
confidence: "high"

# Content
title: "CLI tests rely on process-global state"
statement: |
  The `TestContext` harness modifies process-global state (CWD, environment variables like HOME) to simulate an isolated environment. This forces all CLI tests to run serially (`#[serial]`), preventing parallel execution and increasing the risk of flaky failures if state cleanup is interrupted.

# Evidence supporting the observation
evidence:
  - path: "tests/common/mod.rs"
    loc:
      - "impl TestContext"
    note: "TestContext modifies env::current_dir and env::set_var(HOME), which are process-global."

  - path: "tests/cli_commands.rs"
    loc:
      - "#[serial]"
    note: "Tests are forced to run serially to avoid race conditions on global state."

tags:
  - "test-isolation"
  - "non-determinism"
  - "performance"
