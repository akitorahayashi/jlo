layer: observers

responsibilities: |
  Observers analyze source code and repository state to identify patterns, inconsistencies, and quality issues.
  Each observer has a specialized analytical focus defined in their role.yml.

stateful: true

inputs:
  - Source code and repository files
  - role.yml (specialized focus and learned exclusions)
  - notes/ (declarative memory)
  - feedbacks/ (improvement signals from deciders)

outputs:
  - notes/ (declarative state updates)
  - .jules/exchange/events/<category>/ (normalized observations)

workflow:
  initialization: |
    Read all feedback files at execution start.
    Abstract common rejection patterns.
    Update role.yml's learned_exclusions to reduce noise.
  
  analysis: |
    Analyze your specialized domain.
    Compare findings against learned_exclusions.
    Identify issue-worthy observations.
  
  recording: |
    Create normalized event files under .jules/exchange/events/<category>/.
    Follow event schema below.

constraints:
  - Do NOT write to .jules/exchange/issues/ or .jules/exchange/tasks/
  - Update notes/ declaratively (what IS, not what WAS done)
  - One event per observation
  - Each event must have concrete evidence with file paths and locations

event_schema:
  version: 1
  categories:
    - bugs
    - docs
    - refacts
    - tests
    - updates
  
  filename_format: "YYYY-MM-DD_HHMMSS_<category>_<author_role>_<id>.yml"
  
  required_fields:
    schema_version: 1
    id: string
    created_at: YYYY-MM-DD
    author_role: string
    category: bugs|docs|refacts|tests|updates
    title: string
    statement: string
    evidence:
      - path: string (repo-relative)
        loc: string (line or symbol reference)
        note: string (why this supports the statement)
    confidence: low|medium|high
  
  optional_fields:
    tags: [string]
    related: [event_id]
